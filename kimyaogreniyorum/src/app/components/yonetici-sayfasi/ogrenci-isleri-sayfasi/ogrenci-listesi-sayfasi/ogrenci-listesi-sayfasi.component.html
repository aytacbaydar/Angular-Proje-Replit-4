
<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Kullanıcı Yönetimi</h4>
        </div>
        <div class="card-body">
            <ul class="nav nav-tabs mb-3">
                <li class="nav-item">
                    <a class="nav-link" [class.active]="activeTab === 'students'" (click)="setActiveTab('students')">
                        Öğrenciler
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" [class.active]="activeTab === 'teachers'" (click)="setActiveTab('teachers')">
                        Öğretmenler
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" [class.active]="activeTab === 'new'" (click)="setActiveTab('new')">
                        Yeni Kullanıcılar
                    </a>
                </li>
            </ul>

            <!-- Öğrenciler Tablosu -->
            <div *ngIf="activeTab === 'students'">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5>Öğrenci Listesi</h5>
                    <a class="btn btn-success" routerLink="/yonetici-sayfasi/ogrenci-detay-sayfasi/new">
                        <i class="bi bi-plus-circle"></i> Yeni Öğrenci Ekle
                    </a>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>Avatar</th>
                                <th>Ad Soyad</th>
                                <th>Email</th>
                                <th>Telefon</th>
                                <th>Okul</th>
                                <th>Sınıf</th>
                                <th>Grup</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody *ngIf="!isLoading">
                            <tr *ngFor="let student of students">
                                <td>{{ student.id }}</td>
                                <td>
                                    <img [src]="student.avatar || 'https://ui-avatars.com/api/?name=' + student.adi_soyadi + '&background=random'" 
                                         class="rounded-circle" width="40" height="40" alt="Avatar">
                                </td>
                                <td>{{ student.adi_soyadi }}</td>
                                <td>{{ student.email }}</td>
                                <td>{{ student.cep_telefonu || 'Belirtilmemiş' }}</td>
                                <td>{{ student.okulu || 'Belirtilmemiş' }}</td>
                                <td>{{ student.sinifi || 'Belirtilmemiş' }}</td>
                                <td>{{ student.grubu || 'Belirtilmemiş' }}</td>
                                <td>
                                    <div class="btn-group">
                                        <a [routerLink]="['/yonetici-sayfasi/ogrenci-detay-sayfasi', student.id]" 
                                           class="btn btn-sm btn-outline-primary btn-sm" title="Düzenle">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <button (click)="deleteStudent(student.id)" 
                                                class="btn btn-sm btn-outline-danger btn-sm" title="Sil">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr *ngIf="students.length === 0">
                                <td colspan="9" class="text-center">Henüz öğrenci bulunamadı.</td>
                            </tr>
                        </tbody>
                        <tbody *ngIf="isLoading">
                            <tr>
                                <td colspan="9" class="text-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Yükleniyor...</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Öğretmenler Tablosu -->
            <div *ngIf="activeTab === 'teachers'">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5>Öğretmen Listesi</h5>
                    <a class="btn btn-success" routerLink="/yonetici-sayfasi/ogretmen-detay-sayfasi/new">
                        <i class="bi bi-plus-circle"></i> Yeni Öğretmen Ekle
                    </a>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>Avatar</th>
                                <th>Ad Soyad</th>
                                <th>Email</th>
                                <th>Telefon</th>
                                <th>Branş</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody *ngIf="!isLoading">
                            <tr *ngFor="let teacher of teachers">
                                <td>{{ teacher.id }}</td>
                                <td>
                                    <img [src]="teacher.avatar || 'https://ui-avatars.com/api/?name=' + teacher.adi_soyadi + '&background=random'" 
                                         class="rounded-circle" width="40" height="40" alt="Avatar">
                                </td>
                                <td>{{ teacher.adi_soyadi }}</td>
                                <td>{{ teacher.email }}</td>
                                <td>{{ teacher.cep_telefonu || 'Belirtilmemiş' }}</td>
                                <td>{{ teacher.brans || 'Belirtilmemiş' }}</td>
                                <td>
                                    <div class="btn-group">
                                        <a [routerLink]="['/yonetici-sayfasi/ogretmen-detay-sayfasi', teacher.id]" 
                                           class="btn btn-sm btn-outline-primary btn-sm" title="Düzenle">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <button (click)="deleteTeacher(teacher.id)" 
                                                class="btn btn-sm btn-outline-danger btn-sm" title="Sil">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr *ngIf="teachers.length === 0">
                                <td colspan="7" class="text-center">Henüz öğretmen bulunamadı.</td>
                            </tr>
                        </tbody>
                        <tbody *ngIf="isLoading">
                            <tr>
                                <td colspan="7" class="text-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Yükleniyor...</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Yeni Kullanıcılar Tablosu -->
            <div *ngIf="activeTab === 'new'">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5>Onay Bekleyen Yeni Kullanıcılar</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>Avatar</th>
                                <th>Ad Soyad</th>
                                <th>Email</th>
                                <th>Telefon</th>
                                <th>Kayıt Tarihi</th>
                                <th>Tip</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody *ngIf="!isLoading">
                            <tr *ngFor="let user of newUsers">
                                <td>{{ user.id }}</td>
                                <td>
                                    <img [src]="user.avatar || 'https://ui-avatars.com/api/?name=' + user.adi_soyadi + '&background=random'" 
                                         class="rounded-circle" width="40" height="40" alt="Avatar">
                                </td>
                                <td>{{ user.adi_soyadi }}</td>
                                <td>{{ user.email }}</td>
                                <td>{{ user.cep_telefonu || 'Belirtilmemiş' }}</td>
                                <td>{{ user.created_at | date:'dd/MM/yyyy HH:mm' }}</td>
                                <td>
                                    <span class="badge" [ngClass]="{
                                        'bg-primary': user.rutbe === 'ogrenci',
                                        'bg-success': user.rutbe === 'ogretmen',
                                        'bg-warning': user.rutbe === 'admin'
                                    }">
                                        {{ user.rutbe === 'ogrenci' ? 'Öğrenci' : 
                                           user.rutbe === 'ogretmen' ? 'Öğretmen' : 'Yönetici' }}
                                    </span>
                                </td>
                                <td>
                                    <div class="btn-group">
                                        <a [routerLink]="['/yonetici-sayfasi/ogrenci-detay-sayfasi', user.id]" 
                                           class="btn btn-sm btn-outline-primary btn-sm" title="Detaylar">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <button (click)="approveUser(user.id)" class="btn btn-sm btn-outline-success btn-sm" title="Hızlı Onayla">
                                            <i class="bi bi-check-circle"></i>
                                        </button>
                                        <button (click)="rejectUser(user.id)" class="btn btn-sm btn-outline-danger btn-sm" title="Reddet">
                                            <i class="bi bi-x-circle"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr *ngIf="newUsers.length === 0">
                                <td colspan="8" class="text-center">Onay bekleyen kullanıcı bulunamadı.</td>
                            </tr>
                        </tbody>
                        <tbody *ngIf="isLoading">
                            <tr>
                                <td colspan="8" class="text-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Yükleniyor...</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
